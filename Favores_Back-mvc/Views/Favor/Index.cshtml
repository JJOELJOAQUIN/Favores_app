@model IEnumerable<Favores_Back_mvc.Models.Favor>

@{
    ViewData["Title"] = "Favores";
    var usuarioId = Context.Session.GetInt32("UsuarioId");
    var rol = Context.Session.GetString("UsuarioRol");
}

<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
    .favor-card {
        transition: all .2s ease;
        border-radius: 16px;
    }

        .favor-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 8px 20px rgba(0,0,0,.15);
        }

    .favor-img {
        height: 150px;
        object-fit: cover;
        border-radius: 16px 16px 0 0;
    }
</style>

<div class="container mt-4">

    <!-- HEADER + BOTÓN CREAR -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">Favores disponibles</h2>

        @if (rol == "ADMIN")
        {
            <a asp-controller="Favor" asp-action="Create" class="btn btn-primary">
                <i class="bi bi-plus-lg"></i> Crear Favor
            </a>
        }
    </div>

    <!-- LISTADO -->
    <div class="row g-4">

        @foreach (var f in Model)
        {
            <div class="col-12 col-md-6 col-lg-4">
                <div class="card shadow-sm border-0 favor-card">

                    <!-- IMAGEN -->
                    <img src="/img/categorias/@(
                         f.Categoria?
                          .ToLower()
                          .Replace(" ", "")
                          .Replace("á", "a")
                          .Replace("é", "e")
                          .Replace("í", "i")
                          .Replace("ó", "o")
                          .Replace("ú", "u")
                          ?? "default"
                     ).jpg"
                         onerror="this.src='/img/favores/default-favor.jpg'"
                         class="favor-img" />


                    <div class="card-body">

                        <!-- TÍTULO -->
                        <h5 class="fw-bold">@f.Titulo</h5>

                        <!-- CATEGORÍA -->
                        <span class="badge bg-info text-dark">
                            <i class="bi bi-tag"></i> @f.Categoria
                        </span>

                        <!-- UBICACIÓN -->
                        <p class="mt-2 mb-1 text-muted">
                            <i class="bi bi-geo-alt"></i> @f.Ubicacion
                        </p>

                        <!-- RECOMPENSA -->
                        <p class="fw-bold text-primary mb-1">
                            <i class="bi bi-cash-coin"></i>
                            @f.Recompensa @f.TipoRecompensa
                        </p>

                        <!-- CREADOR -->
                        <p class="text-muted mb-2">
                            <i class="bi bi-person-circle"></i>
                            @(f.Creador?.Nombre ?? "Usuario desconocido")
                        </p>

                        <!-- BOTÓN VER DETALLE -->
                        <a asp-controller="Favor" asp-action="Details" asp-route-id="@f.Id"
                           class="btn btn-outline-primary w-100 mt-2">
                            Ver detalles
                        </a>

                        @if (usuarioId == f.CreadorId)
                        {
                            <form asp-controller="Favor" asp-action="Delete" asp-route-id="@f.Id" method="post">
                                <button class="btn btn-outline-danger w-100 mt-2">
                                    <i class="bi bi-trash"></i> Eliminar
                                </button>
                            </form>
                        }



                    </div>
                </div>
            </div>
        }
    </div>

    @if (!Model.Any())
    {
        <div class="alert alert-light border text-center mt-4">
            <h5>No hay favores disponibles por el momento.</h5>
        </div>
    }

</div>
